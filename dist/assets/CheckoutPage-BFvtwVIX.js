import{d as O,i as L,g as $,r as x,j as e,L as A,c as D,h as w}from"./index-D-IP5-lX.js";import{m as R,H,I as U,q as B,F as T}from"./index-DayB5pOv.js";import{H as z,F as I}from"./Footer-BCAYlC8H.js";import{f as y}from"./formatPrice-llLTZHwJ.js";const Y=c=>{x.useEffect(()=>{const u=document.createElement("script");return u.src=c,u.async=!0,document.body.appendChild(u),()=>{const f=document.querySelector(`script[src="${c}"]`);f&&document.body.removeChild(f)}},[c])},W=()=>{Y("https://checkout.razorpay.com/v1/checkout.js");const{items:c,total:u,itemCount:f,clearCart:C}=O(),{user:i,token:k,isAuthenticated:j}=L(),N=$(),[a,P]=x.useState({email:"",firstName:"",lastName:"",phone:"",street:"",city:"",state:"",pincode:"",paymentMethod:"cod"}),[b,l]=x.useState(!1),[S,n]=x.useState(null);x.useEffect(()=>{i&&P(t=>({...t,email:i.email||"",firstName:i.firstName||"",lastName:i.lastName||"",phone:i.phone||"",street:i.address?.street||"",city:i.address?.city||"",state:i.address?.state||"",pincode:i.address?.pincode||""}))},[i]);const g=c.reduce((t,r)=>t+r.product.price*r.quantity,0),h=g>2e3?0:99,F=g+h,d=t=>{P(r=>({...r,[t.target.name]:t.target.value}))},_=async()=>{n(null),l(!0);const t={firstName:a.firstName,lastName:a.lastName,email:a.email,phone:a.phone,street:a.street,city:a.city,state:a.state,pincode:a.pincode},r=c.map(s=>({productId:s.product.id,quantity:s.quantity}));if(!t.firstName||!t.street||!t.city||!t.pincode){n("Please fill in all required address fields."),l(!1);return}try{const{data:s}=await w.post("/payments/create-order",{items:r});if(!s?.orderId)throw new Error("Failed to create order.");const o="rzp_test_RVniSvbS37g2Xx",M={key:o,amount:s.amount,currency:s.currency,name:"Akash Crackers",description:`Order #${s.receipt||""}`,order_id:s.orderId,handler:async function(p){l(!0);try{const v=await w.post("/payments/verify",{razorpay_order_id:p.razorpay_order_id,razorpay_payment_id:p.razorpay_payment_id,razorpay_signature:p.razorpay_signature,orderDetails:{orderItems:r,shippingAddress:t,paymentMethod:"online"}});C(),alert("Payment Successful! Order placed."),N(`/orders/${v.data.orderId}`)}catch(v){n(v.response?.data?.message||"Payment verification failed."),l(!1)}},prefill:{name:`${a.firstName} ${a.lastName}`,email:a.email,contact:a.phone},theme:{color:"#e63946"},modal:{ondismiss:()=>{n("Payment cancelled."),l(!1)}}},q=new window.Razorpay(M);q.on("payment.failed",p=>{n(`Payment failed: ${p.error.description||"Unknown error"}`),l(!1)}),q.open()}catch(s){n(s.response?.data?.message||s.message||"Could not initiate payment."),l(!1)}},E=async t=>{if(t.preventDefault(),!j||!k){n("You must be logged in."),N("/login",{state:{from:"/checkout"}});return}if(!a.firstName||!a.street||!a.city||!a.pincode){n("Please fill in all required fields.");return}if(a.paymentMethod==="cod"){l(!0),n(null);const r={firstName:a.firstName,lastName:a.lastName,email:a.email,phone:a.phone,street:a.street,city:a.city,state:a.state,pincode:a.pincode},s=c.map(o=>({productId:o.product.id,quantity:o.quantity}));try{const o=await w.post("/orders",{orderItems:s,shippingAddress:r,paymentMethod:"cod"});C(),alert("Order placed! Pay on delivery."),N(`/orders/${o.data._id}`)}catch(o){n(o.response?.data?.message||"Failed to place order.")}finally{l(!1)}}else _()};if(c.length===0&&!b)return e.jsxs("div",{className:"min-h-screen bg-surface-900 flex flex-col",children:[e.jsx(z,{}),e.jsx("div",{className:"flex-1 flex items-center justify-center pt-16",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-20 h-20 mx-auto mb-6 rounded-3xl bg-white/[0.04] border border-white/[0.06] flex items-center justify-center",children:e.jsx(R,{className:"text-surface-500",size:28})}),e.jsx("p",{className:"text-lg text-surface-400 mb-4",children:"Your cart is empty."}),e.jsx(A,{to:"/shop",className:"btn-primary",children:"Go Shopping"})]})}),e.jsx(I,{})]});const m=({label:t,...r})=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-surface-300 uppercase tracking-wider mb-2",children:t}),e.jsx("input",{...r,className:"input"})]});return e.jsxs("div",{className:"min-h-screen bg-surface-900",children:[e.jsx(z,{}),e.jsx("main",{className:"pt-24 pb-16",children:e.jsxs("div",{className:"section-container px-6",children:[e.jsxs("div",{className:"text-center mb-10",children:[e.jsx("p",{className:"label mb-3",children:"Checkout"}),e.jsx("h1",{className:"heading-sm",children:"Complete your order"})]}),e.jsx("form",{onSubmit:E,children:e.jsxs("div",{className:"grid lg:grid-cols-5 gap-10 max-w-5xl mx-auto",children:[e.jsxs("div",{className:"lg:col-span-3 space-y-6",children:[S&&e.jsx("div",{className:"bg-accent/10 border border-accent/20 text-accent text-sm px-4 py-3 rounded-xl",children:S}),e.jsxs("div",{className:"card p-6",children:[e.jsx("h3",{className:"text-sm font-semibold text-white mb-5",children:"1. Contact Information"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(m,{label:"Email",type:"email",name:"email",value:a.email,onChange:d,required:!0}),e.jsx(m,{label:"Phone",type:"tel",name:"phone",value:a.phone,onChange:d,required:!0})]})]}),e.jsxs("div",{className:"card p-6",children:[e.jsx("h3",{className:"text-sm font-semibold text-white mb-5",children:"2. Shipping Address"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(m,{label:"First Name",type:"text",name:"firstName",value:a.firstName,onChange:d,required:!0}),e.jsx(m,{label:"Last Name",type:"text",name:"lastName",value:a.lastName,onChange:d,required:!0})]}),e.jsx(m,{label:"Street",type:"text",name:"street",value:a.street,onChange:d,required:!0}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(m,{label:"City",type:"text",name:"city",value:a.city,onChange:d,required:!0}),e.jsx(m,{label:"State",type:"text",name:"state",value:a.state,onChange:d,required:!0}),e.jsx(m,{label:"Pincode",type:"text",name:"pincode",value:a.pincode,onChange:d,required:!0,maxLength:6})]})]})]}),e.jsxs("div",{className:"card p-6",children:[e.jsx("h3",{className:"text-sm font-semibold text-white mb-5",children:"3. Payment Method"}),e.jsx("div",{className:"space-y-3",children:[{value:"card",icon:e.jsx(H,{size:14}),label:"Card (Online Payment)"},{value:"upi",icon:e.jsx("span",{className:"text-xs font-bold",children:"UPI"}),label:"UPI (Online Payment)"},{value:"cod",icon:e.jsx(U,{size:14}),label:"Cash on Delivery"}].map(t=>e.jsxs("label",{className:`flex items-center gap-3 p-4 rounded-xl cursor-pointer transition-all duration-300 ${a.paymentMethod===t.value?"bg-accent/10 border border-accent/30":"bg-white/[0.02] border border-white/[0.06] hover:bg-white/[0.04]"}`,children:[e.jsx("input",{type:"radio",name:"paymentMethod",value:t.value,checked:a.paymentMethod===t.value,onChange:d,className:"accent-accent"}),e.jsx("span",{className:"text-accent",children:t.icon}),e.jsx("span",{className:"text-sm text-surface-300",children:t.label})]},t.value))})]})]}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"card p-6 sticky top-24",children:[e.jsx("h3",{className:"text-sm font-semibold text-white mb-5",children:"Order Summary"}),e.jsx("div",{className:"space-y-3 max-h-48 overflow-y-auto mb-5 pr-1",children:c.map(t=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:t.product.images[0],alt:t.product.name,className:"w-10 h-10 object-cover rounded-lg"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs font-medium text-white line-clamp-1",children:t.product.name}),e.jsxs("p",{className:"text-2xs text-surface-500",children:["Qty: ",t.quantity]})]}),e.jsx("p",{className:"text-xs font-semibold text-white",children:y(t.product.price*t.quantity)})]},t.product.id))}),e.jsxs("div",{className:"space-y-2 border-t border-white/[0.06] pt-4 mb-5",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-surface-400",children:"Subtotal"}),e.jsx("span",{className:"text-white",children:y(g)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-surface-400",children:"Shipping"}),e.jsx("span",{className:h===0?"text-emerald-400":"text-white",children:h===0?"FREE":y(h)})]}),e.jsx("div",{className:"h-px bg-white/[0.06]"}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-base font-semibold text-white",children:"Total"}),e.jsx("span",{className:"text-base font-bold text-accent",children:y(F)})]})]}),e.jsx("button",{type:"submit",disabled:b||!j,className:"btn-primary w-full py-3.5 mb-3",children:b?e.jsx(D,{size:"sm"}):e.jsxs(e.Fragment,{children:[e.jsx(B,{size:12})," ",a.paymentMethod==="cod"?"Place COD Order":"Proceed to Payment"]})}),!j&&e.jsx("p",{className:"text-center text-xs text-accent",children:"Please log in to complete your order."}),e.jsxs("div",{className:"mt-3 text-center text-2xs text-surface-500 flex items-center justify-center gap-1.5",children:[e.jsx(T,{className:"text-emerald-500",size:10}),e.jsx("span",{children:a.paymentMethod==="cod"?"Pay on Delivery":"Secure Payment"})]})]})})]})})]})}),e.jsx(I,{})]})};export{W as default};
