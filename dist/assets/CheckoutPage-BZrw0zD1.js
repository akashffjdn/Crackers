import{d as D,i as R,g as _,r as u,j as e,L as $,c as L,h as k}from"./index-vjTx7X_X.js";import{p as A,N as T,O as U,u as V,c as B}from"./index-C8lrwkSk.js";import{H as I,F as z}from"./Footer-SUEj5nCx.js";import{f as N}from"./formatPrice-llLTZHwJ.js";const H=i=>{u.useEffect(()=>{const h=document.createElement("script");return h.src=i,h.async=!0,document.body.appendChild(h),()=>{const j=document.querySelector(`script[src="${i}"]`);j&&document.body.removeChild(j)}},[i])},J=()=>{H("https://checkout.razorpay.com/v1/checkout.js");const{items:i,total:h,itemCount:j,clearCart:C}=D(),{user:d,token:E,isAuthenticated:y}=R(),v=_(),[r,P]=u.useState({email:"",firstName:"",lastName:"",phone:"",street:"",city:"",state:"",pincode:"",paymentMethod:"cod"}),[b,c]=u.useState(!1),[S,o]=u.useState(null);u.useEffect(()=>{d&&P(a=>({...a,email:d.email||"",firstName:d.firstName||"",lastName:d.lastName||"",phone:d.phone||"",street:d.address?.street||"",city:d.address?.city||"",state:d.address?.state||"",pincode:d.address?.pincode||""}))},[d]);const w=i.reduce((a,m)=>a+m.product.price*m.quantity,0),g=w>2e3?0:99,M=w+g,n=a=>{const{name:m,value:t}=a.target;P(s=>({...s,[m]:t}))},q=async()=>{console.log("--- displayRazorpay function started ---"),o(null),c(!0);const a={firstName:r.firstName,lastName:r.lastName,email:r.email,phone:r.phone,street:r.street,city:r.city,state:r.state,pincode:r.pincode},m=i.map(t=>({productId:t.product.id,quantity:t.quantity}));if(!a.firstName||!a.lastName||!a.email||!a.phone||!a.street||!a.city||!a.state||!a.pincode){o("Please fill in all required address fields before proceeding to payment."),c(!1);return}try{const{data:t}=await k.post("/payments/create-order",{items:m});if(!t||!t.orderId)throw new Error("Failed to create Razorpay order ID.");const s="rzp_test_RVniSvbS37g2Xx";console.log("VITE Razorpay Key ID:",s);const l={key:s,amount:t.amount,currency:t.currency,name:"Akash Crackers",description:`Order Payment #${t.receipt||""}`,order_id:t.orderId,handler:async function(p){console.log("Razorpay Success Response:",p),c(!0);try{const x={razorpay_order_id:p.razorpay_order_id,razorpay_payment_id:p.razorpay_payment_id,razorpay_signature:p.razorpay_signature,orderDetails:{orderItems:m,shippingAddress:a,paymentMethod:"online"}},F=await k.post("/payments/verify",x);console.log("Backend Verification Response:",F.data),C(),alert("Payment Successful! Order placed."),v(`/orders/${F.data.orderId}`)}catch(x){console.error("Payment Verification Failed:",x),o(x.response?.data?.message||x.message||"Payment verification failed. Please contact support."),c(!1)}},prefill:{name:`${r.firstName} ${r.lastName}`,email:r.email,contact:r.phone},notes:{address:`${r.street}, ${r.city}`},theme:{color:"#E53E3E"},modal:{ondismiss:function(){console.log("Razorpay checkout modal dismissed"),o("Payment process was cancelled."),c(!1)}}},f=new window.Razorpay(l);f.on("payment.failed",function(p){console.error("Razorpay Payment Failed:",p.error),o(`Payment failed: ${p.error.description||p.error.reason||"Unknown error"}. Please try again or choose another method.`),c(!1)}),f.open()}catch(t){console.error("Error initiating Razorpay checkout:",t);const s=t.response?.data?.message;s&&(s.includes("Insufficient stock")||s.includes("Product not found"))?o(`Order Error: ${s}`):o(s||t.message||"Could not initiate payment. Please try again."),c(!1)}},O=async a=>{if(a.preventDefault(),!y||!E){o("You must be logged in to place an order."),v("/login",{state:{from:"/checkout"}});return}if(!r.firstName||!r.lastName||!r.email||!r.phone||!r.street||!r.city||!r.state||!r.pincode){o("Please fill in all required address fields.");return}if(r.paymentMethod==="cod"){c(!0),o(null);const m={firstName:r.firstName,lastName:r.lastName,email:r.email,phone:r.phone,street:r.street,city:r.city,state:r.state,pincode:r.pincode},s={orderItems:i.map(l=>({productId:l.product.id,quantity:l.quantity})),shippingAddress:m,paymentMethod:"cod"};try{const l=await k.post("/orders",s);console.log("COD Order submitted successfully:",l.data),C(),alert("Order placed successfully! Pay on delivery."),v(`/orders/${l.data._id}`)}catch(l){console.error("Error submitting COD order:",l);const f=l.response?.data?.message;o(f||l.message||"Failed to place COD order.")}finally{c(!1)}}else q()};return i.length===0&&!b?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-orange-50/30 to-red-50/30 flex flex-col",children:[e.jsx(I,{}),e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center animate-fade-in",children:[e.jsxs("div",{className:"inline-block relative mb-6",children:[e.jsx("div",{className:"absolute inset-0 bg-gray-200 rounded-full blur-2xl opacity-50"}),e.jsx(A,{className:"relative text-7xl text-gray-300 mx-auto"})]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Your cart is empty."}),e.jsx($,{to:"/shop",className:"inline-flex items-center space-x-2 bg-gradient-to-r from-red-600 to-orange-600 text-white px-8 py-4 rounded-xl font-bold hover:from-red-700 hover:to-orange-700 transition-all transform hover:scale-105 shadow-xl",children:e.jsx("span",{children:"Go Shopping"})})]})}),e.jsx(z,{})]}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-orange-50/30 to-red-50/30 flex flex-col",children:[e.jsx(I,{}),e.jsxs("main",{className:"flex-1 container-custom px-4 sm:px-6 lg:px-8 py-12",children:[e.jsxs("div",{className:"text-center mb-12 animate-fade-in",children:[e.jsx("h1",{className:"text-4xl md:text-5xl font-bold font-display gradient-text mb-2",children:"Checkout"}),e.jsx("p",{className:"text-xl text-gray-600",children:"Complete your purchase securely"})]}),e.jsx("form",{onSubmit:O,children:e.jsxs("div",{className:"grid lg:grid-cols-2 gap-12",children:[e.jsxs("div",{className:"space-y-8",children:[S&&e.jsxs("div",{className:"bg-red-50 border-l-4 border-red-500 text-red-700 px-6 py-4 rounded-xl shadow-lg animate-slide-down",role:"alert",children:[e.jsx("strong",{className:"font-bold block mb-1",children:"âš ï¸ Error!"}),e.jsx("span",{children:S})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-xl rounded-3xl p-6 shadow-xl border border-gray-100 animate-slide-up",children:[e.jsx("h3",{className:"text-2xl font-bold font-display mb-6 pb-4 border-b border-gray-200 text-gray-900",children:"1. Contact Information"}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-bold text-gray-700 mb-2",children:"Email Address *"}),e.jsx("input",{id:"email",type:"email",name:"email",value:r.email,onChange:n,required:!0,className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all bg-white"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"phone",className:"block text-sm font-bold text-gray-700 mb-2",children:"Phone Number *"}),e.jsx("input",{id:"phone",type:"tel",name:"phone",value:r.phone,onChange:n,required:!0,className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all bg-white"})]})]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-xl rounded-3xl p-6 shadow-xl border border-gray-100 animate-slide-up",style:{animationDelay:"0.1s"},children:[e.jsx("h3",{className:"text-2xl font-bold font-display mb-6 pb-4 border-b border-gray-200 text-gray-900",children:"2. Shipping Address"}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"firstName",className:"block text-sm font-bold text-gray-700 mb-2",children:"First Name *"}),e.jsx("input",{id:"firstName",type:"text",name:"firstName",value:r.firstName,onChange:n,required:!0,className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all bg-white"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"lastName",className:"block text-sm font-bold text-gray-700 mb-2",children:"Last Name *"}),e.jsx("input",{id:"lastName",type:"text",name:"lastName",value:r.lastName,onChange:n,required:!0,className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all bg-white"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"street",className:"block text-sm font-bold text-gray-700 mb-2",children:"Street Address *"}),e.jsx("input",{id:"street",type:"text",name:"street",value:r.street,onChange:n,required:!0,className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all bg-white"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"city",className:"block text-sm font-bold text-gray-700 mb-2",children:"City *"}),e.jsx("input",{id:"city",type:"text",name:"city",value:r.city,onChange:n,required:!0,className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all bg-white"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"state",className:"block text-sm font-bold text-gray-700 mb-2",children:"State *"}),e.jsx("input",{id:"state",type:"text",name:"state",value:r.state,onChange:n,required:!0,className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all bg-white"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"pincode",className:"block text-sm font-bold text-gray-700 mb-2",children:"Pincode *"}),e.jsx("input",{id:"pincode",type:"text",name:"pincode",value:r.pincode,onChange:n,required:!0,maxLength:6,pattern:"[1-9][0-9]{5}",title:"Enter a valid 6-digit Indian pincode",className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all bg-white"})]})]})]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-xl rounded-3xl p-6 shadow-xl border border-gray-100 animate-slide-up",style:{animationDelay:"0.2s"},children:[e.jsx("h3",{className:"text-2xl font-bold font-display mb-6 pb-4 border-b border-gray-200 text-gray-900",children:"3. Payment Method"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("label",{className:`flex items-center p-5 border-2 rounded-xl cursor-pointer transition-all ${r.paymentMethod==="card"?"border-red-500 bg-red-50 shadow-lg":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("input",{type:"radio",name:"paymentMethod",value:"card",checked:r.paymentMethod==="card",onChange:n,className:"mr-4 w-5 h-5 text-red-600"}),e.jsx(T,{className:"mr-3 text-blue-600 text-xl"}),e.jsx("span",{className:"font-semibold",children:"Card (Online Payment)"})]}),e.jsxs("label",{className:`flex items-center p-5 border-2 rounded-xl cursor-pointer transition-all ${r.paymentMethod==="upi"?"border-red-500 bg-red-50 shadow-lg":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("input",{type:"radio",name:"paymentMethod",value:"upi",checked:r.paymentMethod==="upi",onChange:n,className:"mr-4 w-5 h-5 text-red-600"}),e.jsx("img",{src:"https://upload.wikimedia.org/wikipedia/commons/e/e1/UPI-Logo-vector.svg",alt:"UPI",className:"w-6 h-6 mr-3"}),e.jsx("span",{className:"font-semibold",children:"UPI (Online Payment)"})]}),e.jsxs("label",{className:`flex items-center p-5 border-2 rounded-xl cursor-pointer transition-all ${r.paymentMethod==="cod"?"border-red-500 bg-red-50 shadow-lg":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("input",{type:"radio",name:"paymentMethod",value:"cod",checked:r.paymentMethod==="cod",onChange:n,className:"mr-4 w-5 h-5 text-red-600"}),e.jsx(U,{className:"mr-3 text-green-600 text-xl"}),e.jsx("span",{className:"font-semibold",children:"Cash on Delivery (COD)"})]})]})]})]}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white/80 backdrop-blur-xl rounded-3xl p-6 shadow-2xl border border-gray-100 sticky top-28 animate-slide-up",children:[e.jsx("h3",{className:"text-2xl font-bold font-display text-gray-900 mb-6 pb-4 border-b border-gray-200",children:"Order Summary"}),e.jsx("div",{className:"space-y-3 max-h-60 overflow-y-auto mb-6 pr-2",children:i.map(a=>e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-gray-50 rounded-xl",children:[e.jsx("img",{src:a.product.images[0],alt:a.product.name,className:"w-16 h-16 object-cover rounded-xl"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-semibold text-sm line-clamp-1 text-gray-900",children:a.product.name}),e.jsxs("p",{className:"text-gray-500 text-xs",children:["Qty: ",a.quantity]})]}),e.jsx("p",{className:"font-bold text-gray-900",children:N(a.product.price*a.quantity)})]},a.product.id))}),e.jsxs("div",{className:"space-y-3 border-t border-gray-200 pt-4 mb-6",children:[e.jsxs("div",{className:"flex justify-between text-gray-700",children:[e.jsx("span",{className:"font-medium",children:"Subtotal:"}),e.jsx("span",{className:"font-bold",children:N(w)})]}),e.jsxs("div",{className:"flex justify-between text-gray-700",children:[e.jsx("span",{className:"font-medium",children:"Shipping:"}),e.jsx("span",{className:g===0?"text-green-600 font-bold":"font-bold",children:g===0?"FREE ðŸŽ‰":N(g)})]}),e.jsxs("div",{className:"flex justify-between font-bold text-xl pt-3 border-t border-gray-200",children:[e.jsx("span",{className:"text-gray-900",children:"Total:"}),e.jsx("span",{className:"text-red-600 text-2xl",children:N(M)})]})]}),e.jsxs("button",{type:"submit",disabled:b||!y,className:"w-full bg-gradient-to-r from-red-600 to-orange-600 text-white py-4 px-6 rounded-xl font-bold text-lg hover:from-red-700 hover:to-orange-700 transition-all transform hover:scale-105 shadow-xl hover:shadow-2xl flex items-center justify-center space-x-2 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none",children:[b?e.jsx(L,{size:"sm",color:"text-white"}):e.jsx(V,{}),e.jsx("span",{children:b?"Processing...":y?r.paymentMethod==="cod"?"Place COD Order":"Proceed to Payment":"Login to Order"})]}),!y&&e.jsx("p",{className:"text-center text-sm text-red-600 mt-3 font-semibold",children:"Please log in or sign up to complete your order."}),e.jsxs("div",{className:"mt-6 text-center text-sm text-gray-600 flex items-center justify-center space-x-2 bg-green-50 rounded-xl p-3",children:[e.jsx(B,{className:"text-green-600"}),e.jsx("span",{className:"font-semibold",children:r.paymentMethod==="cod"?"Pay on Delivery":"Secure Online Payment"})]})]})})]})})]}),e.jsx(z,{})]})};export{J as default};
