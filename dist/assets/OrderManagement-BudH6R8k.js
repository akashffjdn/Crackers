import{r as n,R as Q,j as e,h as U,c as W,L as _}from"./index-vjTx7X_X.js";import{G as q,$ as R,C as B,V as z,d as X,i as Y,_ as Z,I as ee,U as te,K as se,S as ae}from"./index-C8lrwkSk.js";import{A as re}from"./AdminLayout-Bh7ZBj6g.js";import{f as le}from"./formatPrice-llLTZHwJ.js";import{P as ne}from"./Pagination-DJ4pCTOd.js";const ie=({order:a,isOpen:u,onClose:o,onUpdateStatus:m})=>{const[d,p]=n.useState("pending"),[g,f]=n.useState(""),[C,O]=n.useState("");Q.useEffect(()=>{a&&(p(a.status),f(a.trackingNumber||""))},[a]);const S=[{value:"pending",label:"Pending",color:"text-yellow-600 bg-yellow-50 border-yellow-200",description:"Order received, awaiting confirmation"},{value:"confirmed",label:"Confirmed",color:"text-blue-600 bg-blue-50 border-blue-200",description:"Order confirmed, preparing for processing"},{value:"processing",label:"Processing",color:"text-orange-600 bg-orange-50 border-orange-200",description:"Order is being prepared and packaged"},{value:"shipped",label:"Shipped",color:"text-purple-600 bg-purple-50 border-purple-200",description:"Order has been shipped and is in transit"},{value:"delivered",label:"Delivered",color:"text-green-600 bg-green-50 border-green-200",description:"Order has been delivered successfully"},{value:"cancelled",label:"Cancelled",color:"text-red-600 bg-red-50 border-red-200",description:"Order has been cancelled"}],v=r=>{r.preventDefault(),a&&(m(a.id,d,g||void 0),o())},h=()=>{const r=Date.now(),x=Math.floor(Math.random()*1e3).toString().padStart(3,"0");f(`SP${r}${x}`)};return!u||!a?null:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto m-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Update Order Status"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Order ID: #",a.id]})]}),e.jsx("button",{onClick:o,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(q,{className:"text-gray-500"})})]}),e.jsx("div",{className:"p-6 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Customer:"}),e.jsxs("p",{className:"text-gray-900",children:[a.shippingAddress.firstName," ",a.shippingAddress.lastName]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Order Date:"}),e.jsx("p",{className:"text-gray-900",children:new Date(a.createdAt).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Total Amount:"}),e.jsxs("p",{className:"text-gray-900 font-semibold",children:["â‚¹",a.total]})]})]})}),e.jsxs("form",{onSubmit:v,className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Current Status"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:S.map(r=>e.jsxs("label",{className:`relative flex items-center p-4 border-2 rounded-lg cursor-pointer transition-all ${d===r.value?r.color:"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("input",{type:"radio",name:"status",value:r.value,checked:d===r.value,onChange:x=>p(x.target.value),className:"sr-only"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold",children:r.label}),d===r.value&&e.jsx("div",{className:"w-4 h-4 bg-current rounded-full"})]}),e.jsx("p",{className:"text-xs mt-1 opacity-80",children:r.description})]})]},r.value))})]}),(d==="shipped"||d==="delivered")&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tracking Number"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"text",value:g,onChange:r=>f(r.target.value),placeholder:"Enter tracking number",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500"}),e.jsxs("button",{type:"button",onClick:h,className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors flex items-center space-x-2",children:[e.jsx(R,{}),e.jsx("span",{children:"Generate"})]})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Leave empty to auto-generate or enter custom tracking number"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Internal Notes (Optional)"}),e.jsx("textarea",{value:C,onChange:r=>O(r.target.value),placeholder:"Add any internal notes about this status change...",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500"})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-blue-900 mb-2",children:"Status Change Preview"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsxs("p",{children:["Order #",a.id," status will be updated to"," ",e.jsx("span",{className:"font-semibold",children:S.find(r=>r.value===d)?.label})]}),g&&e.jsxs("p",{className:"mt-1",children:["Tracking number: ",e.jsx("span",{className:"font-mono",children:g})]}),e.jsx("p",{className:"text-xs text-blue-600 mt-2",children:"Customer will be notified via email and SMS about this status change."})]})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-4 pt-6 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:o,className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:"Cancel"}),e.jsxs("button",{type:"submit",className:"px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 flex items-center space-x-2",children:[e.jsx(R,{}),e.jsx("span",{children:"Update Status"})]})]})]})]})})},de=({status:a,showIcon:u=!0})=>{const m=(p=>{switch(p){case"pending":return{color:"bg-yellow-100 text-yellow-800",icon:B,label:"Pending"};case"confirmed":return{color:"bg-blue-100 text-blue-800",icon:z,label:"Confirmed"};case"processing":return{color:"bg-purple-100 text-purple-800",icon:Y,label:"Processing"};case"shipped":return{color:"bg-orange-100 text-orange-800",icon:X,label:"Shipped"};case"delivered":return{color:"bg-green-100 text-green-800",icon:z,label:"Delivered"};case"cancelled":return{color:"bg-red-100 text-red-800",icon:q,label:"Cancelled"};default:return{color:"bg-gray-100 text-gray-800",icon:B,label:p}}})(a),d=m.icon;return e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${m.color}`,children:[u&&e.jsx(d,{className:"w-3 h-3 mr-1"}),m.label]})},ue=()=>{const[a,u]=n.useState([]),[o,m]=n.useState(!0),[d,p]=n.useState(null),[g,f]=n.useState([]),[C,O]=n.useState(null),[S,v]=n.useState(!1),[h,r]=n.useState(""),[x,A]=n.useState(""),[N,F]=n.useState(""),[y,P]=n.useState(1),[k]=n.useState(10),[T,L]=n.useState(1),[$,D]=n.useState(0),E=t=>{const s=(t.items||[]).map(i=>{const w=typeof i.product=="object"&&i.product!==null?i.product:null,H=i.nameAtOrder||w?.name||"Unknown Product",M=i.priceAtOrder||w?.price||0,K=i.imageAtOrder||(w?.images?w.images[0]:"/placeholder.png"),J=w?._id||(typeof i.product=="string"?i.product:"unknown");return{quantity:i.quantity,product:{id:J,name:H,price:M,images:[K],categoryId:"",description:"",shortDescription:"",mrp:M,rating:0,reviewCount:0,soundLevel:"Low",burnTime:"",stock:1,features:[],specifications:{},tags:[]}}}),l=typeof t.userId=="string"?t.userId:t.userId._id,c=typeof t.userId=="object"?t.userId:null;return{...t,id:t._id,items:s,userId:l,shippingAddress:{...t.shippingAddress,firstName:t.shippingAddress.firstName||c?.firstName||"",lastName:t.shippingAddress.lastName||c?.lastName||"",email:t.shippingAddress.email||c?.email||""},status:t.status,paymentMethod:t.paymentMethod,paymentStatus:t.paymentStatus}},j=n.useCallback(async(t=1)=>{m(!0),p(null);try{console.log(`Fetching all orders (admin) page: ${t}...`);const s=await U.get("/orders",{params:{page:t,limit:k}});if(s.data&&Array.isArray(s.data.orders))console.log(`Fetched ${s.data.orders.length} orders.`),u(s.data.orders.map(E)),L(s.data.totalPages||1),D(s.data.totalOrders||0),P(s.data.currentPage||t);else if(Array.isArray(s.data)){console.warn("Backend /api/orders does not seem to support pagination. Loading all.");const l=s.data.map(E);u(l),L(Math.ceil(l.length/k)),D(l.length),P(t)}else throw new Error("Invalid orders data format received")}catch(s){console.error("Error fetching orders:",s),p(s.response?.data?.message||s.message||"Failed to fetch orders"),u([])}finally{m(!1)}},[k]);n.useEffect(()=>{j(y)},[j,y]),n.useEffect(()=>{let t=a;if(h){const s=h.toLowerCase();t=t.filter(l=>l.id.toLowerCase().includes(s)||`${l.shippingAddress.firstName} ${l.shippingAddress.lastName}`.toLowerCase().includes(s)||l.shippingAddress.email.toLowerCase().includes(s)||l.shippingAddress.phone&&l.shippingAddress.phone.includes(s))}if(x&&(t=t.filter(s=>s.status===x)),N){const s=new Date;s.setHours(0,0,0,0);let l=new Date(s);switch(N){case"today":break;case"week":l.setDate(s.getDate()-7);break;case"month":l.setMonth(s.getMonth()-1);break;default:l=new Date(0)}t=t.filter(c=>new Date(c.createdAt)>=l)}t.sort((s,l)=>new Date(l.createdAt).getTime()-new Date(s.createdAt).getTime()),f(t)},[a,h,x,N]),Math.ceil(g.length/k);const I=g,G=async(t,s,l)=>{v(!1),f(c=>c.map(i=>i.id===t?{...i,status:"processing"}:i)),p(null);try{console.log(`Updating order ${t} status to ${s}...`),await U.put(`/orders/${t}/status`,{status:s,trackingNumber:l}),console.log(`Order ${t} updated successfully.`),j(y)}catch(c){console.error("Error updating order status:",c);const i=c.response?.data?.message||c.message||"Failed to update order status";p(i),alert(`Update Failed: ${i}`),j(y)}},V=t=>{switch(t){case"paid":return"text-green-600 bg-green-50";case"pending":return"text-yellow-600 bg-yellow-50";case"failed":return"text-red-600 bg-red-50";default:return"text-gray-600 bg-gray-50"}},b=n.useMemo(()=>({total:$,pending:a.filter(t=>t.status==="pending").length,confirmed:a.filter(t=>t.status==="confirmed").length,processing:a.filter(t=>t.status==="processing").length,shipped:a.filter(t=>t.status==="shipped").length,delivered:a.filter(t=>t.status==="delivered").length,cancelled:a.filter(t=>t.status==="cancelled").length}),[a,$]);return e.jsx(re,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{children:[" ",e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Order Management"})," ",e.jsx("p",{className:"text-gray-600",children:"Track and manage customer orders"})," "]}),e.jsxs("button",{className:"flex items-center space-x-2 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors mt-4 md:mt-0",children:[" ",e.jsx(Z,{})," ",e.jsx("span",{children:"Export Orders"})," "]})]}),o&&e.jsx("div",{className:"p-6 bg-white rounded-lg shadow-sm text-center",children:e.jsx(W,{text:"Loading orders..."})}),d&&!o&&e.jsxs("div",{className:"p-4 bg-red-50 text-red-700 border border-red-200 rounded-lg",children:["Error: ",d,e.jsx("button",{onClick:()=>j(y),className:"ml-4 px-2 py-1 border border-red-300 rounded text-sm hover:bg-red-100",children:"Retry"})]}),!o&&!d&&e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-7 gap-4",children:[{label:"Total",value:b.total,color:"text-gray-800"},{label:"Pending",value:b.pending,color:"text-yellow-800"},{label:"Confirmed",value:b.confirmed,color:"text-blue-800"},{label:"Processing",value:b.processing,color:"text-purple-800"},{label:"Shipped",value:b.shipped,color:"text-orange-800"},{label:"Delivered",value:b.delivered,color:"text-green-800"},{label:"Cancelled",value:b.cancelled,color:"text-red-800"}].map((t,s)=>e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[" ",e.jsxs("div",{className:`text-2xl font-bold ${t.color}`,children:[" ",t.value," "]})," ",e.jsx("div",{className:"text-sm text-gray-600",children:t.label})," "]},s))}),!o&&!d&&e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"order-search",className:"block text-sm font-medium text-gray-700 mb-1",children:"Search"}),e.jsxs("div",{className:"relative",children:[" ",e.jsx(ee,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 pointer-events-none"})," ",e.jsx("input",{id:"order-search",type:"search",value:h,onChange:t=>r(t.target.value),placeholder:"Order ID, Customer...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500"})," "]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"order-status-filter",className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{id:"order-status-filter",value:x,onChange:t=>A(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 bg-white",children:[e.jsx("option",{value:"",children:"All Status"})," ",e.jsx("option",{value:"pending",children:"Pending"})," ",e.jsx("option",{value:"confirmed",children:"Confirmed"})," ",e.jsx("option",{value:"processing",children:"Processing"})," ",e.jsx("option",{value:"shipped",children:"Shipped"})," ",e.jsx("option",{value:"delivered",children:"Delivered"})," ",e.jsx("option",{value:"cancelled",children:"Cancelled"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"order-date-filter",className:"block text-sm font-medium text-gray-700 mb-1",children:"Date Range"}),e.jsxs("select",{id:"order-date-filter",value:N,onChange:t=>F(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 bg-white",children:[e.jsx("option",{value:"",children:"All Time"})," ",e.jsx("option",{value:"today",children:"Today"})," ",e.jsx("option",{value:"week",children:"Last 7 days"})," ",e.jsx("option",{value:"month",children:"Last 30 days"})]})]}),e.jsxs("div",{className:"flex items-end",children:[" ",e.jsx("button",{onClick:()=>{r(""),A(""),F("")},type:"button",className:"w-full px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:" Clear Filters "})," "]})]})}),!o&&!d&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Order"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Customer"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Payment"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:I.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:7,className:"px-6 py-10 text-center text-gray-500",children:[e.jsx(te,{className:"mx-auto text-4xl text-gray-300 mb-3"}),"No orders found",h||x||N?" matching your criteria":"","."]})}):I.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsxs(_,{to:`/orders/${t.id}`,target:"_blank",className:"text-sm font-semibold text-blue-600 hover:text-blue-800",children:["#",t.id.substring(0,8),"..."]}),e.jsxs("div",{className:"text-sm text-gray-500",children:[t.items.length," item",t.items.length!==1?"s":""]}),t.trackingNumber&&e.jsxs("div",{className:"text-xs text-gray-400 font-mono mt-1",children:[" ",t.trackingNumber," "]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900 truncate max-w-[180px]",children:[t.shippingAddress.firstName," ",t.shippingAddress.lastName]}),e.jsx("a",{href:`mailto:${t.shippingAddress.email}`,className:"text-sm text-blue-600 hover:underline truncate max-w-[180px]",children:t.shippingAddress.email}),e.jsx("div",{className:"text-sm text-gray-500",children:t.shippingAddress.phone})]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900",children:le(t.total)}),e.jsxs("div",{className:"text-xs text-gray-500 capitalize",children:[" ",t.paymentMethod," "]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx(de,{status:t.status})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full capitalize ${V(t.paymentStatus)}`,children:t.paymentStatus})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsxs("div",{className:"text-sm text-gray-900",children:[" ",new Date(t.createdAt).toLocaleDateString()," "]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[" ",new Date(t.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})," "]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[e.jsxs(_,{to:`/orders/${t.id}`,target:"_blank",className:"text-blue-600 hover:text-blue-900 p-1",title:"View Order",children:[" ",e.jsx(se,{})," "]}),e.jsxs("button",{onClick:()=>{O(t),v(!0)},className:"text-green-600 hover:text-green-900 p-1",title:"Update Status",children:[" ",e.jsx(ae,{})," "]})]})})]},t.id))})]})}),T>1&&e.jsx(ne,{currentPage:y,totalPages:T,onPageChange:t=>j(t)})]}),e.jsx(ie,{order:C,isOpen:S,onClose:()=>v(!1),onUpdateStatus:G})]})})};export{ue as default};
