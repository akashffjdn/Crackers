import{e as O,r as l,h as P,j as e,c as E,L as F}from"./index-D-IP5-lX.js";import{O as S,P as C,w as L,a as T,u as $}from"./index-DayB5pOv.js";import{H as x,F as g}from"./Footer-BCAYlC8H.js";import{f as j}from"./formatPrice-llLTZHwJ.js";const _=()=>{const{orderId:c}=O(),[r,u]=l.useState(null),[y,o]=l.useState(!0),[m,p]=l.useState(null),N=s=>{const t=(s.items||[]).map(d=>{const a=typeof d.product=="object"&&d.product!==null?d.product:null,k=d.nameAtOrder||a?.name||"Unknown Product",f=d.priceAtOrder||a?.price||0,I=d.imageAtOrder||(a?.images?a.images[0]:"/placeholder.png"),A=a?._id||(typeof d.product=="string"?d.product:"unknown");return{quantity:d.quantity,product:{id:A,name:k,price:f,images:[I],categoryId:"",description:"",shortDescription:"",mrp:f,rating:0,reviewCount:0,soundLevel:"Low",burnTime:"",stock:1,features:[],specifications:{},tags:[]}}}),n=typeof s.userId=="string"?s.userId:s.userId._id,i=typeof s.userId=="object"?s.userId:null;return{...s,id:s._id,items:t,userId:n,shippingAddress:{...s.shippingAddress,firstName:s.shippingAddress.firstName||i?.firstName||"",lastName:s.shippingAddress.lastName||i?.lastName||"",email:s.shippingAddress.email||i?.email||""},status:s.status,paymentMethod:s.paymentMethod,paymentStatus:s.paymentStatus}},h=l.useCallback(async()=>{if(!c){p("No Order ID provided."),o(!1);return}o(!0),p(null);try{console.log(`Fetching order details for ID: ${c}`);const s=await P.get(`/orders/${c}`);if(console.log("API Response:",s.data),s.data)u(N(s.data));else throw new Error("Order data not found in response.")}catch(s){console.error("Error fetching order:",s);const t=s.response?.status===404?"Order not found.":s.response?.data?.message||s.message||"Failed to load order details.";p(t),u(null)}finally{o(!1)}},[c]);l.useEffect(()=>{h()},[h]);const v=s=>{switch(s){case"pending":return"text-yellow-600 bg-yellow-50 border border-yellow-200";case"confirmed":return"text-blue-600 bg-blue-50 border border-blue-200";case"processing":return"text-purple-600 bg-purple-50 border border-purple-200";case"shipped":return"text-orange-600 bg-orange-50 border border-orange-200";case"delivered":return"text-green-600 bg-green-50 border border-green-200";case"cancelled":return"text-red-600 bg-red-50 border border-red-200";default:return"text-gray-600 bg-gray-50 border border-gray-200"}},b=[{key:"confirmed",label:"Confirmed",icon:C},{key:"processing",label:"Processing",icon:L},{key:"shipped",label:"Shipped",icon:T},{key:"delivered",label:"Delivered",icon:$}],w=(s,t)=>{if(t==="cancelled")return"pending";const n=["pending","confirmed","processing","shipped","delivered"],i=n.indexOf(t),d=n.indexOf(s);return d===-1||i===-1?"pending":d<=i?"completed":s==="confirmed"&&(t==="pending"||t==="confirmed")||s==="processing"&&t==="processing"||s==="shipped"&&t==="shipped"?"current":"pending"};return y?e.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col",children:[e.jsx(x,{}),e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsx(E,{text:"Loading order details..."})}),e.jsx(g,{})]}):m||!r?e.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col",children:[e.jsx(x,{}),e.jsx("div",{className:"flex-1 flex items-center justify-center text-center px-4",children:e.jsxs("div",{children:[e.jsx(S,{className:"text-6xl text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:m||"Order Not Found"}),e.jsx("p",{className:"text-gray-600 mb-8",children:m?"Could not load order details.":"The order you're looking for doesn't exist or you may not have permission to view it."}),e.jsx(F,{to:"/dashboard",className:"bg-red-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-red-700 transition-colors",children:"Back to My Orders"})]})}),e.jsx(g,{})]}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(x,{}),e.jsxs("main",{className:"max-w-4xl mx-auto px-4 py-8",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:["Order #",r.id.substring(0,12),"..."]}),e.jsxs("p",{className:"text-gray-600",children:["Placed on ",new Date(r.createdAt).toLocaleDateString("en-IN",{year:"numeric",month:"long",day:"numeric"})]})]}),e.jsx("div",{className:"mt-4 md:mt-0",children:e.jsx("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium capitalize border ${v(r.status)}`,children:e.jsx("span",{className:"ml-1",children:r.status})})})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Order Progress"}),e.jsx("div",{className:"flex justify-between items-start",children:b.map((s,t)=>{const n=w(s.key,r.status),i=s.icon;return e.jsxs("div",{className:"flex flex-col items-center flex-1 relative px-1",children:[t>0&&e.jsx("div",{className:`absolute top-4 left-0 w-1/2 h-0.5 ${n==="completed"||n==="current"?"bg-green-300":"bg-gray-200"}`,"aria-hidden":"true"}),t<b.length-1&&e.jsx("div",{className:`absolute top-4 right-0 w-1/2 h-0.5 ${n==="completed"?"bg-green-300":"bg-gray-200"}`,"aria-hidden":"true"}),e.jsx("div",{className:`relative z-10 rounded-full p-3 mb-2 ${n==="completed"?"bg-green-100 text-green-600":n==="current"?"bg-blue-100 text-blue-600 animate-pulse":"bg-gray-100 text-gray-400"}`,children:e.jsx(i,{className:"text-xl"})}),e.jsx("p",{className:`text-center text-xs sm:text-sm font-medium ${n==="completed"||n==="current"?"text-gray-900":"text-gray-500"}`,children:s.label})]},s.key)})}),r.status!=="cancelled"&&(r.trackingNumber||r.estimatedDelivery)&&e.jsxs("div",{className:"mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg text-sm text-blue-800 space-y-1",children:[r.trackingNumber&&e.jsxs("p",{children:[e.jsx("strong",{children:"Tracking Number:"})," ",e.jsx("span",{className:"font-mono",children:r.trackingNumber})]}),r.estimatedDelivery&&e.jsxs("p",{children:[e.jsx("strong",{children:"Estimated Delivery:"})," ",new Date(r.estimatedDelivery).toLocaleDateString("en-IN",{year:"numeric",month:"long",day:"numeric"})]})]}),r.status==="cancelled"&&e.jsx("div",{className:"mt-6 p-4 bg-red-50 border border-red-200 rounded-lg text-sm text-red-800",children:e.jsx("p",{children:e.jsx("strong",{children:"This order has been cancelled."})})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:["Order Items (",r.items.length,")"]}),e.jsx("div",{className:"space-y-4",children:r.items.map((s,t)=>e.jsxs("div",{className:"flex items-center space-x-4 p-4 border rounded-lg border-gray-200",children:[e.jsx("img",{src:s.product.images[0],alt:s.product.name,className:"w-16 h-16 object-cover rounded-lg flex-shrink-0",onError:n=>{n.target.src="/placeholder.png"}}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-medium text-gray-900 line-clamp-2",children:s.product.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Qty: ",s.quantity]})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsx("p",{className:"font-semibold text-gray-900",children:j(s.product.price*s.quantity)})})]},s.product.id||t))}),e.jsx("div",{className:"border-t border-gray-200 pt-4 mt-4",children:e.jsxs("div",{className:"flex justify-between items-center text-lg font-semibold",children:[e.jsx("span",{children:"Total Paid"}),e.jsx("span",{className:"text-red-600",children:j(r.total)})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Shipping Address"}),e.jsxs("div",{className:"text-gray-600 space-y-1",children:[e.jsxs("p",{className:"font-medium text-gray-800",children:[r.shippingAddress.firstName," ",r.shippingAddress.lastName]}),e.jsx("p",{children:r.shippingAddress.street}),e.jsxs("p",{children:[r.shippingAddress.city,", ",r.shippingAddress.state," ",r.shippingAddress.pincode]}),e.jsxs("p",{className:"pt-2",children:[" ",e.jsx("strong",{children:"Phone:"})," ",r.shippingAddress.phone," "]}),e.jsxs("p",{children:[" ",e.jsx("strong",{children:"Email:"})," ",r.shippingAddress.email," "]})]})]})]}),e.jsx(g,{})]})};export{_ as default};
