import{b as Q,a as H,d as _,g as q,r as n,j as e,c as B}from"./index-D-IP5-lX.js";import{C as z,w as R,D as V}from"./index-DayB5pOv.js";import{H as j,F as y}from"./Footer-BCAYlC8H.js";import{c as K,f as F}from"./formatPrice-llLTZHwJ.js";const X=()=>{const{products:h,isLoading:o,error:w}=Q(),{categories:u,isLoading:g,error:N}=H(),{addToCart:E,error:v}=_(),P=q(),[f,$]=n.useState(""),[r,b]=n.useState(null),[d,A]=n.useState(""),[p,I]=n.useState("name"),[C,k]=n.useState({}),[M,c]=n.useState(!1),x=n.useMemo(()=>{if(o||g)return[];let s=h.filter(t=>{const a=r?typeof t.categoryId=="object"&&t.categoryId!==null&&"_id"in t.categoryId?t.categoryId._id===r:t.categoryId===r:!0,l=d?t.soundLevel===d:!0,i=f.toLowerCase(),m=t.name.toLowerCase().includes(i)||t.shortDescription&&t.shortDescription.toLowerCase().includes(i);return a&&l&&m});switch(p){case"name":s=s.sort((t,a)=>t.name.localeCompare(a.name));break;case"price_low":s=s.sort((t,a)=>t.price-a.price);break;case"price_high":s=s.sort((t,a)=>a.price-t.price);break;case"rating":s=s.sort((t,a)=>a.rating-t.rating);break}return s},[h,r,d,f,p,o,g]);n.useEffect(()=>{o||k(s=>{const t={};return x.forEach(a=>{t[a.id]=s[a.id]||1}),t})},[x,o]);const O=(s,t)=>{const a=Number(t);isNaN(a)||k(l=>({...l,[s]:Math.max(1,a)}))},T=async s=>{const t=h.find(D=>D.id===s);if(!t)return;if(t.stock===0){alert("Sorry, this product is out of stock.");return}const a=C[s]??1,l=Math.min(a,t.stock),i=Math.max(1,l),m=await E(t,i);!m&&v==="Please log in to add items."?alert("Please log in to add items to your cart."):m||alert(`Failed to add item: ${v||"Unknown error"}`)},S=s=>{P(`/product/${s}`),window.scrollTo(0,0)},L=s=>{b(s),c(!1)};return g||o?e.jsxs(e.Fragment,{children:[e.jsx(j,{}),e.jsx("main",{className:"flex-1 flex items-center justify-center min-h-[60vh]",children:e.jsx(B,{text:"Loading quick order..."})}),e.jsx(y,{})]}):N||w?e.jsxs(e.Fragment,{children:[e.jsx(j,{}),e.jsxs("main",{className:"flex-1 container mx-auto px-4 py-16 text-center text-red-600",children:["Error loading data: ",N||w]}),e.jsx(y,{})]}):e.jsxs(e.Fragment,{children:[e.jsx(j,{}),e.jsxs("main",{className:"max-w-7xl mx-auto px-4 py-10",children:[e.jsx("h1",{className:"text-4xl font-bold text-center mb-8",children:"Quick Order"}),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-8",children:[e.jsxs("section",{className:"flex-1",children:[e.jsx("div",{className:"lg:hidden mb-4 flex items-center justify-between",children:e.jsxs("div",{className:"flex-1 flex items-center space-x-3",children:[e.jsxs("button",{onClick:()=>c(!0),className:"inline-flex items-center px-4 py-2 rounded-lg bg-gray-100 text-gray-700 font-semibold shadow hover:bg-gray-200 transition","aria-label":"Open categories menu",children:[e.jsx(z,{className:"mr-2"}),"Categories"]}),e.jsx("span",{className:"text-gray-700",children:r?u.find(s=>s.id===r)?.name??"Category":"All Categories"})]})}),e.jsxs("div",{className:"mb-4 flex flex-col md:flex-row md:space-x-4",children:[e.jsx("input",{type:"search",placeholder:"Search products...",value:f,onChange:s=>$(s.target.value),className:"flex-grow rounded-full border border-gray-300 px-5 py-3 shadow-sm focus:outline-none focus:ring-2 focus:ring-red-600","aria-label":"Product search"}),e.jsxs("select",{className:"mt-3 md:mt-0 rounded-full border border-gray-300 px-4 py-3 text-gray-700 bg-white",value:d,onChange:s=>A(s.target.value),"aria-label":"Filter by sound level",children:[e.jsx("option",{value:"",children:"All Sound Levels"}),e.jsx("option",{value:"Low",children:"Low"}),e.jsx("option",{value:"Medium",children:"Medium"}),e.jsx("option",{value:"High",children:"High"}),e.jsx("option",{value:"Mixed",children:"Mixed"})]}),e.jsxs("select",{className:"mt-3 md:mt-0 rounded-full border border-gray-300 px-4 py-3 text-gray-700 bg-white",value:p,onChange:s=>I(s.target.value),"aria-label":"Sort products",children:[e.jsx("option",{value:"name",children:"Sort by Name"}),e.jsx("option",{value:"price_low",children:"Price: Low to High"}),e.jsx("option",{value:"price_high",children:"Price: High to Low"}),e.jsx("option",{value:"rating",children:"Sort by Rating"})]})]}),x.length===0?e.jsxs("div",{className:"text-center text-gray-500 mt-20 py-10 border border-dashed rounded-lg",children:[e.jsx(R,{className:"mx-auto text-4xl text-gray-300 mb-4"}),e.jsx("p",{children:"No products found matching your criteria."})]}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-6",children:x.map(s=>{const t=K(s.mrp,s.price),a=C[s.id]||1,l=s.stock;return e.jsxs("div",{className:"border rounded-lg p-5 shadow-sm flex flex-col bg-white",children:[e.jsxs("div",{role:"button",tabIndex:0,className:"cursor-pointer",onClick:()=>S(s.id),onKeyDown:i=>i.key==="Enter"&&S(s.id),"aria-label":`View ${s.name}`,children:[e.jsx("img",{src:s.images[0],alt:s.name,className:"w-full h-44 object-cover rounded-md mb-4",loading:"lazy",onError:i=>i.target.src="fallback-image.png"}),e.jsx("h2",{className:"font-semibold text-lg text-gray-900 mb-1 line-clamp-2",children:s.name})]}),e.jsx("p",{className:"text-gray-600 text-sm line-clamp-2 mb-2",children:s.shortDescription}),e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("span",{className:"text-red-600 font-bold text-xl",children:F(s.price)}),t>0&&e.jsxs(e.Fragment,{children:[" ",e.jsx("span",{className:"line-through text-gray-400 text-sm",children:F(s.mrp)})," ",e.jsxs("span",{className:"bg-green-100 text-green-800 text-xs rounded px-2 py-0.5",children:[t,"% OFF"]})," "]})]}),e.jsxs("div",{className:"mt-auto flex items-center justify-between space-x-3",children:[e.jsx("div",{children:l===0?e.jsx("span",{className:"text-red-600 font-semibold text-sm",children:"Out of stock"}):l<10?e.jsxs("span",{className:"text-yellow-600 font-semibold text-sm",children:["Only ",l," left"]}):e.jsx("span",{className:"text-green-600 font-semibold text-sm",children:"In stock"})}),e.jsx("input",{type:"number",min:1,max:l>0?l:1,value:a,onChange:i=>O(s.id,Number(i.target.value)),className:"w-16 text-center border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-red-600",disabled:l===0,"aria-label":`Quantity for ${s.name}`}),e.jsx("button",{onClick:()=>T(s.id),disabled:l===0,className:"bg-red-600 text-white px-4 rounded py-2 font-semibold hover:bg-red-700 transition disabled:cursor-not-allowed disabled:bg-gray-400","aria-label":`Add ${a} of ${s.name} to cart`,children:"Add"})]})]},s.id)})})]}),e.jsx("aside",{className:"w-full lg:w-64 hidden lg:block",children:e.jsxs("div",{className:"sticky top-24 p-6 bg-white border rounded-xl shadow-sm",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Categories"}),e.jsxs("ul",{role:"list",className:"space-y-2",children:[e.jsxs("li",{children:[" ",e.jsx("button",{type:"button",onClick:()=>b(null),className:`block w-full text-left px-4 py-2 rounded-full font-semibold transition ${r===null?"bg-red-600 text-white shadow":"text-gray-700 hover:bg-red-100"}`,"aria-pressed":r===null,children:" All Categories "})," "]}),u.map(s=>e.jsxs("li",{children:[" ",e.jsxs("button",{type:"button",onClick:()=>b(s.id),className:`block w-full text-left px-4 py-2 rounded-full font-semibold transition ${r===s.id?"bg-red-600 text-white shadow":"text-gray-700 hover:bg-red-100"}`,"aria-pressed":r===s.id,children:[" ",s.name," "]})," "]},s.id))]})]})})]})]}),M&&e.jsxs("div",{className:"fixed inset-0 z-50",children:[e.jsx("div",{className:"fixed inset-0 bg-black/40",onClick:()=>c(!1),"aria-label":"Close categories"}),e.jsxs("aside",{className:"fixed top-0 left-0 h-full w-64 bg-white shadow-lg z-10 p-6 flex flex-col",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-bold",children:"Categories"}),e.jsxs("button",{onClick:()=>c(!1),"aria-label":"Close categories",children:[" ",e.jsx(V,{className:"text-xl"})," "]})]}),e.jsxs("ul",{className:"space-y-2 flex-1 overflow-y-auto",children:[e.jsx("li",{children:e.jsx("button",{type:"button",onClick:()=>L(null),className:`block w-full text-left px-4 py-2 rounded-full font-semibold transition ${r===null?"bg-red-600 text-white shadow":"text-gray-700 hover:bg-red-100"}`,"aria-pressed":r===null,children:" All Categories "})}),u.map(s=>e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:()=>L(s.id),className:`block w-full text-left px-4 py-2 rounded-full font-semibold transition ${r===s.id?"bg-red-600 text-white shadow":"text-gray-700 hover:bg-red-100"}`,"aria-pressed":r===s.id,children:[" ",s.name," "]})},s.id))]})]})]}),e.jsx(y,{})]})};export{X as default};
