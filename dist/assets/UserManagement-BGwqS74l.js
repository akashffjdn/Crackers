import{r as a,h as w,j as e,c as O}from"./index-D-IP5-lX.js";import{U as _,Y as G,V as H,M as K,Z as Q,P as X,p as ee,D as se,N as te}from"./index-DayB5pOv.js";import{A as re}from"./AdminLayout-DomCUjgJ.js";import{P as ae}from"./Pagination-CYRI1rSB.js";const de=()=>{const[i,S]=a.useState([]),[m,k]=a.useState(!0),[x,F]=a.useState(null),[U,B]=a.useState([]),[u,E]=a.useState(""),[b,$]=a.useState(""),[y,P]=a.useState(""),[v,D]=a.useState(1),[A]=a.useState(10),[j,L]=a.useState(null),[J,h]=a.useState(!1),[C,N]=a.useState(!1),[R,d]=a.useState(null),[l,g]=a.useState({firstName:"",lastName:"",email:"",phone:"",role:"user",isActive:!0,address:{}}),c=a.useCallback(async()=>{k(!0),F(null);try{const t=(await w.get("/users")).data.map(r=>({...r,id:r._id}));S(t)}catch(s){console.error("Error fetching users:",s),F(s.response?.data?.message||s.message||"Failed to fetch users"),S([])}finally{k(!1)}},[]);a.useEffect(()=>{c()},[c]),a.useEffect(()=>{let s=i;if(u){const t=u.toLowerCase();s=s.filter(r=>r.firstName.toLowerCase().includes(t)||r.lastName.toLowerCase().includes(t)||r.email.toLowerCase().includes(t)||r.phone.includes(u))}if(b&&(s=s.filter(t=>t.role===b)),y){const t=y==="active";s=s.filter(r=>r.isActive===t)}B(s),v!==1&&D(1)},[i,u,b,y,v]);const T=Math.ceil(U.length/A),I=(v-1)*A,M=U.slice(I,I+A),V=()=>{L(null),g({firstName:"",lastName:"",email:"",phone:"",role:"user",isActive:!0,address:{}}),d(null),h(!0)},W=s=>{L(s),g({firstName:s.firstName,lastName:s.lastName,email:s.email,phone:s.phone,role:s.role,isActive:s.isActive,address:s.address?{...s.address}:{}}),d(null),h(!0)},n=s=>{const{name:t,value:r,type:o}=s.target;if(t.startsWith("address.")){const f=t.split(".")[1];g(z=>({...z,address:{...z.address,[f]:r}}))}else g(o==="checkbox"?f=>({...f,[t]:s.target.checked}):f=>({...f,[t]:r}))},q=async s=>{if(s.preventDefault(),N(!0),d(null),!l.firstName||!l.lastName||!l.email||!l.phone){d("Please fill in all required fields."),N(!1);return}try{if(j)await w.put(`/users/${j.id}`,l);else{alert("Admin user creation via this form is not implemented. Users should register themselves."),d("Admin user creation via this form is not implemented."),N(!1);return}h(!1),c()}catch(t){console.error("Error saving user:",t),d(t.response?.data?.message||t.message||"Failed to save user")}finally{N(!1)}},Y=async s=>{const t=i.find(o=>o.id===s);if(!t)return;const r=!t.isActive;try{await w.put(`/users/${s}`,{isActive:r}),c(),alert(`User ${r?"activated":"deactivated"} successfully.`)}catch(o){console.error("Error toggling user status:",o),alert(`Failed to toggle status: ${o.response?.data?.message||o.message}`)}},Z=async s=>{const t=i.find(r=>r.id===s);if(t?.role==="admin"){alert("Cannot delete admin users.");return}if(window.confirm(`Are you sure you want to delete user ${t?.firstName} ${t?.lastName}?`))try{await w.delete(`/users/${s}`),c(),alert("User deleted successfully.")}catch(r){console.error("Error deleting user:",r),alert(`Failed to delete user: ${r.response?.data?.message||r.message}`)}},p=a.useMemo(()=>({total:i.length,active:i.filter(s=>s.isActive).length,inactive:i.filter(s=>!s.isActive).length,admins:i.filter(s=>s.role==="admin").length,customers:i.filter(s=>s.role==="user").length}),[i]);return e.jsx(re,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"User Management"}),e.jsx("p",{className:"text-gray-600",children:"Manage customer accounts and admin users"})]}),e.jsxs("div",{className:"flex items-center space-x-3 mt-4 md:mt-0",children:[e.jsxs("button",{className:"flex items-center space-x-2 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:[e.jsx(_,{}),e.jsx("span",{children:"Export Users"})]}),e.jsxs("button",{onClick:V,className:"flex items-center space-x-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:[e.jsx(G,{}),e.jsx("span",{children:"Add User"})]})]})]}),m&&e.jsx("div",{className:"p-6 bg-white rounded-lg shadow-sm text-center",children:e.jsx(O,{text:"Loading users..."})}),x&&!m&&e.jsxs("div",{className:"p-4 bg-red-50 text-red-700 border border-red-200 rounded-lg",children:["Error: ",x,e.jsx("button",{onClick:c,className:"ml-4 px-2 py-1 border border-red-300 rounded text-sm hover:bg-red-100",children:"Retry"})]}),!m&&!x&&e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[{label:"Total Users",value:p.total,color:"text-blue-800"},{label:"Active",value:p.active,color:"text-green-800"},{label:"Inactive",value:p.inactive,color:"text-red-800"},{label:"Customers",value:p.customers,color:"text-purple-800"},{label:"Admins",value:p.admins,color:"text-yellow-800"}].map((s,t)=>e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[e.jsx("div",{className:`text-2xl font-bold ${s.color}`,children:s.value}),e.jsx("div",{className:"text-sm text-gray-600",children:s.label})]},t))}),!m&&!x&&e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"user-search",className:"block text-sm font-medium text-gray-700 mb-1",children:"Search"}),e.jsxs("div",{className:"relative",children:[e.jsx(H,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 pointer-events-none"}),e.jsx("input",{id:"user-search",type:"search",value:u,onChange:s=>E(s.target.value),placeholder:"Name, email, phone...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"role-filter",className:"block text-sm font-medium text-gray-700 mb-1",children:"Role"}),e.jsxs("select",{id:"role-filter",value:b,onChange:s=>$(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 bg-white",children:[e.jsx("option",{value:"",children:"All Roles"}),e.jsx("option",{value:"user",children:"Customer"}),e.jsx("option",{value:"admin",children:"Admin"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"status-filter",className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{id:"status-filter",value:y,onChange:s=>P(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 bg-white",children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{onClick:()=>{E(""),$(""),P("")},className:"w-full px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",type:"button",children:"Clear Filters"})})]})}),!m&&!x&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Contact"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Role"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Joined"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:M.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-10 text-center text-gray-500",children:"No users found matching your criteria."})}):M.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10 bg-gradient-to-r from-red-100 to-orange-100 rounded-full flex items-center justify-center",children:e.jsxs("span",{className:"text-red-600 font-semibold text-sm",children:[s.firstName?.charAt(0),s.lastName?.charAt(0)]})}),e.jsxs("div",{className:"ml-4",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900 truncate max-w-[150px]",children:[s.firstName," ",s.lastName]}),e.jsxs("div",{className:"text-xs text-gray-500 font-mono",children:["ID: ",s.id.substring(0,8),"..."]})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsx("a",{href:`mailto:${s.email}`,className:"text-sm text-blue-600 hover:text-blue-800 hover:underline",children:s.email}),e.jsx("div",{className:"text-sm text-gray-500",children:s.phone}),s.address&&e.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:[s.address.city,", ",s.address.state]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold leading-5 rounded-full capitalize ${s.role==="admin"?"bg-yellow-100 text-yellow-800":"bg-blue-100 text-blue-800"}`,children:s.role})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${s.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:[e.jsx("span",{className:`mr-1.5 h-2 w-2 rounded-full ${s.isActive?"bg-green-400":"bg-red-400"}`}),s.isActive?"Active":"Inactive"]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(s.createdAt).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("div",{className:"flex items-center justify-end space-x-3",children:[e.jsx("button",{onClick:()=>W(s),className:"text-blue-600 hover:text-blue-800 p-1 rounded hover:bg-blue-50 transition-colors",title:"Edit User",children:e.jsx(K,{})}),e.jsx("button",{onClick:()=>Y(s.id),className:`p-1 rounded transition-colors ${s.isActive?"text-yellow-600 hover:text-yellow-800 hover:bg-yellow-50":"text-green-600 hover:text-green-800 hover:bg-green-50"}`,title:s.isActive?"Deactivate User":"Activate User",children:s.isActive?e.jsx(Q,{}):e.jsx(X,{})}),e.jsx("button",{onClick:()=>Z(s.id),className:"text-red-600 hover:text-red-800 p-1 rounded hover:bg-red-50 transition-colors",title:"Delete User",disabled:s.role==="admin",children:e.jsx(ee,{})})]})})]},s.id))})]})}),T>1&&e.jsx(ae,{currentPage:v,totalPages:T,onPageChange:D})]}),J&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-lg mx-auto max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 sticky top-0 bg-white z-10",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:j?"Edit User":"Add New User"}),e.jsx("button",{onClick:()=>h(!1),className:"p-2 text-gray-400 hover:text-gray-600 rounded-md hover:bg-gray-100 transition-colors","aria-label":"Close modal",children:e.jsx(se,{})})]}),e.jsxs("form",{onSubmit:q,className:"flex-1 overflow-y-auto p-6 space-y-5",children:[R&&e.jsx("div",{className:"p-3 bg-red-50 text-red-700 border border-red-200 rounded-lg text-sm",children:R}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"form-firstName",className:"block text-sm font-medium text-gray-700 mb-1",children:"First Name *"}),e.jsx("input",{id:"form-firstName",type:"text",name:"firstName",value:l.firstName,onChange:n,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"form-lastName",className:"block text-sm font-medium text-gray-700 mb-1",children:"Last Name *"}),e.jsx("input",{id:"form-lastName",type:"text",name:"lastName",value:l.lastName,onChange:n,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"form-email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email *"}),e.jsx("input",{id:"form-email",type:"email",name:"email",value:l.email,onChange:n,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"form-phone",className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone *"}),e.jsx("input",{id:"form-phone",type:"tel",name:"phone",value:l.phone,onChange:n,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"form-role",className:"block text-sm font-medium text-gray-700 mb-1",children:"Role"}),e.jsxs("select",{id:"form-role",name:"role",value:l.role,onChange:n,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 bg-white",children:[e.jsx("option",{value:"user",children:"Customer"}),e.jsx("option",{value:"admin",children:"Admin"})]})]}),e.jsxs("fieldset",{className:"border p-4 rounded-lg",children:[e.jsx("legend",{className:"text-sm font-medium text-gray-700 px-1",children:"Address (Optional)"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{type:"text",name:"address.street",value:l.address?.street||"",onChange:n,placeholder:"Street",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[e.jsx("input",{type:"text",name:"address.city",value:l.address?.city||"",onChange:n,placeholder:"City",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500"}),e.jsx("input",{type:"text",name:"address.state",value:l.address?.state||"",onChange:n,placeholder:"State",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500"}),e.jsx("input",{type:"text",name:"address.pincode",value:l.address?.pincode||"",onChange:n,placeholder:"Pincode",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500"})]})]})]}),e.jsxs("div",{className:"flex items-center pt-2",children:[e.jsx("input",{id:"form-isActive",type:"checkbox",name:"isActive",checked:l.isActive,onChange:n,className:"h-4 w-4 text-red-600 focus:ring-red-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"form-isActive",className:"ml-2 block text-sm font-medium text-gray-900",children:"Active User"})]})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-4 p-6 border-t border-gray-200 sticky bottom-0 bg-white z-10",children:[e.jsx("button",{onClick:()=>h(!1),type:"button",className:"px-5 py-2.5 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors text-sm font-medium",children:"Cancel"}),e.jsxs("button",{onClick:q,type:"button",disabled:C,className:"flex items-center justify-center space-x-2 px-5 py-2.5 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors text-sm font-medium disabled:bg-gray-300 disabled:cursor-not-allowed",children:[C?e.jsx(O,{size:"sm",color:"text-white"}):e.jsx(te,{}),e.jsx("span",{children:C?"Saving...":j?"Update User":"Create User"})]})]})]})})]})})};export{de as default};
